global:
  # å‘Šè­¦è§£å†³è¶…æ—¶æ—¶é—´
  resolve_timeout: 5m
  # é»˜è®¤é€šçŸ¥æ¨¡æ¿ï¼ˆå¯é€‰ï¼‰
  # slack_api_url: ''

# å‘Šè­¦è·¯ç”±é…ç½®
route:
  # é»˜è®¤æ¥æ”¶è€…
  receiver: 'default-receiver'
  # åˆ†ç»„è§„åˆ™ï¼šç›¸åŒæ ‡ç­¾çš„å‘Šè­¦ä¼šè¢«åˆ†ç»„
  group_by: ['alertname', 'cluster', 'service']
  # åˆ†ç»„ç­‰å¾…æ—¶é—´ï¼šåŒä¸€ç»„å†…çš„å‘Šè­¦ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´å†å‘é€
  group_wait: 10s
  # åŒä¸€ç»„å†…æ–°å‘Šè­¦çš„ç­‰å¾…æ—¶é—´
  group_interval: 10s
  # é‡å¤å‘Šè­¦çš„å‘é€é—´éš”
  repeat_interval: 12h
  # å­è·¯ç”±ï¼ˆå¯ä»¥æ ¹æ®æ ‡ç­¾è·¯ç”±åˆ°ä¸åŒçš„æ¥æ”¶è€…ï¼‰
  routes:
    # ä¸¥é‡å‘Šè­¦è·¯ç”±
    - match:
        severity: critical
      receiver: 'critical-receiver'
      continue: true
    # è­¦å‘Šçº§åˆ«å‘Šè­¦è·¯ç”±
    - match:
        severity: warning
      receiver: 'warning-receiver'
      continue: true

# æŠ‘åˆ¶è§„åˆ™ï¼ˆå‡å°‘å‘Šè­¦å™ªéŸ³ï¼‰
inhibit_rules:
  # å¦‚æœåº”ç”¨å®•æœºï¼ŒæŠ‘åˆ¶å…¶ä»–å‘Šè­¦
  - source_match:
      alertname: 'ApplicationDown'
    target_match:
      severity: 'warning'
    equal: ['instance', 'service']

# æ¥æ”¶è€…é…ç½®
receivers:
  # é»˜è®¤æ¥æ”¶è€…ï¼ˆæ§åˆ¶å°è¾“å‡ºï¼Œç”¨äºæµ‹è¯•ï¼‰
  - name: 'default-receiver'
    webhook_configs:
      - url: 'http://localhost:9093/api/v1/alerts'
        send_resolved: true

  # ä¸¥é‡å‘Šè­¦æ¥æ”¶è€…
  - name: 'critical-receiver'
    # å¯ä»¥é…ç½®å¤šç§é€šçŸ¥æ–¹å¼
    # 1. é‚®ä»¶é€šçŸ¥ï¼ˆéœ€è¦é…ç½® SMTPï¼‰
    # email_configs:
    #   - to: 'ops-team@example.com'
    #     from: 'alertmanager@example.com'
    #     smarthost: 'smtp.example.com:587'
    #     auth_username: 'alertmanager@example.com'
    #     auth_password: 'password'
    #     headers:
    #       Subject: 'ğŸš¨ ä¸¥é‡å‘Šè­¦: {{ .GroupLabels.alertname }}'
    
    # 2. Webhook é€šçŸ¥ï¼ˆå¯ä»¥å‘é€åˆ°é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ç­‰ï¼‰
    webhook_configs:
      - url: 'http://localhost:9093/api/v1/alerts'
        send_resolved: true
        # å¯ä»¥æ·»åŠ è‡ªå®šä¹‰å¤´éƒ¨
        # http_config:
        #   bearer_token: 'your-token'
    
    # 3. é’‰é’‰é€šçŸ¥ï¼ˆéœ€è¦é…ç½® Webhook URLï¼‰
    # webhook_configs:
    #   - url: 'https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN'
    #     send_resolved: true

  # è­¦å‘Šçº§åˆ«æ¥æ”¶è€…
  - name: 'warning-receiver'
    webhook_configs:
      - url: 'http://localhost:9093/api/v1/alerts'
        send_resolved: true

# æ¨¡æ¿æ–‡ä»¶ï¼ˆå¯é€‰ï¼Œç”¨äºè‡ªå®šä¹‰å‘Šè­¦æ¶ˆæ¯æ ¼å¼ï¼‰
# templates:
#   - '/etc/alertmanager/templates/*.tmpl'

