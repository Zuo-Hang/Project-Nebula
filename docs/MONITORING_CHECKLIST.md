# ç›‘æ§å‘Šè­¦æ£€æŸ¥æ¸…å•

## âœ… å·²å®Œæˆçš„é…ç½®

### 1. åŸºç¡€è®¾æ–½ âœ…
- [x] Prometheus æœåŠ¡é…ç½®
- [x] Grafana æœåŠ¡é…ç½®
- [x] AlertManager æœåŠ¡é…ç½®
- [x] Prometheus é…ç½®æŒ‚è½½ï¼ˆæ•´ä¸ªç›®å½•ï¼‰
- [x] å‘Šè­¦è§„åˆ™æ–‡ä»¶æŒ‚è½½

### 2. å‘Šè­¦è§„åˆ™ âœ…
- [x] LLM è¯·æ±‚å¤±è´¥ç‡å‘Šè­¦
- [x] LLM è¯·æ±‚å»¶è¿Ÿå‘Šè­¦
- [x] ç¼“å­˜å‘½ä¸­ç‡å‘Šè­¦
- [x] MQ æ¶ˆè´¹å»¶è¿Ÿå‘Šè­¦
- [x] MQ æ¶ˆè´¹é‡è¯•ç‡å‘Šè­¦
- [x] ä¸šåŠ¡å¤„ç†é”™è¯¯ç‡å‘Šè­¦
- [x] Redis æ“ä½œå¤±è´¥ç‡å‘Šè­¦
- [x] å®šæ—¶ä»»åŠ¡æ‰§è¡Œå¼‚å¸¸å‘Šè­¦
- [x] åº”ç”¨å®ä¾‹å®•æœºå‘Šè­¦
- [x] JVM å†…å­˜ä½¿ç”¨ç‡å‘Šè­¦
- [x] æ¶ˆæ¯å»¶è¿Ÿå‘Šè­¦
- [x] è¿‡æœŸæ¶ˆæ¯å‘Šè­¦
- [x] æ•°æ®å®Œæ•´æ€§å‘Šè­¦
- [x] å¤–éƒ¨æœåŠ¡è°ƒç”¨å¤±è´¥å‘Šè­¦

**æ€»è®¡ï¼š14 ä¸ªå‘Šè­¦è§„åˆ™**

### 3. Grafana ä»ªè¡¨ç›˜ âœ…
- [x] LLM è¯·æ±‚ç›‘æ§ä»ªè¡¨ç›˜
- [x] ç¼“å­˜ç›‘æ§ä»ªè¡¨ç›˜
- [x] MQ ç›‘æ§ä»ªè¡¨ç›˜
- [x] ä¸šåŠ¡ç›‘æ§ä»ªè¡¨ç›˜
- [x] åŸºç¡€è®¾æ–½ç›‘æ§ä»ªè¡¨ç›˜

### 4. AlertManager é…ç½® âœ…
- [x] AlertManager æœåŠ¡é…ç½®
- [x] å‘Šè­¦è·¯ç”±è§„åˆ™
- [x] å‘Šè­¦æŠ‘åˆ¶è§„åˆ™
- [x] æ¥æ”¶è€…é…ç½®ï¼ˆåŸºç¡€é…ç½®ï¼‰

---

## âš ï¸ éœ€è¦éªŒè¯çš„é¡¹

### 1. æŒ‡æ ‡åç§°éªŒè¯

å¯åŠ¨åº”ç”¨åï¼Œéœ€è¦éªŒè¯ä»¥ä¸‹æŒ‡æ ‡åç§°æ˜¯å¦æ­£ç¡®ï¼š

| å‘Šè­¦è§„åˆ™ä¸­ä½¿ç”¨çš„æŒ‡æ ‡ | å®é™…æŒ‡æ ‡åç§° | çŠ¶æ€ |
|---------------------|-------------|------|
| `llm_req_total` | `llm_req_total` | âœ… æ­£ç¡® |
| `llm_req_duration_ms_bucket` | `llm_req_duration_ms_bucket` | âš ï¸ éœ€éªŒè¯ï¼ˆTimer è‡ªåŠ¨åˆ›å»ºï¼‰ |
| `llm_cache_hit_total` | `llm_cache_hit_total` | âœ… æ­£ç¡® |
| `llm_cache_miss_total` | `llm_cache_miss_total` | âœ… æ­£ç¡® |
| `HandlerMsg_duration_ms_bucket` | `HandlerMsg_duration_ms_bucket` | âš ï¸ éœ€éªŒè¯ |
| `HandlerBusiness_total` | `HandlerBusiness_total` | âœ… æ­£ç¡® |
| `scheduler_task_total` | `scheduler_task_total` | âœ… æ­£ç¡® |
| `scheduler_task_duration_seconds_bucket` | `scheduler_task_duration_seconds_bucket` | âš ï¸ éœ€éªŒè¯ï¼ˆtiming å¯èƒ½åˆ›å»º `_seconds`ï¼‰ |
| `redis_get_req_total` | `redis_get_req_total` | âœ… æ­£ç¡® |
| `msg_latency_s` | `msg_latency_s` | âš ï¸ éœ€éªŒè¯ï¼ˆGauge æŒ‡æ ‡ï¼‰ |
| `expire_msg_counter_total` | `expire_msg_counter_total` | âœ… æ­£ç¡® |
| `integrity_missing_count_total` | `integrity_missing_count_total` | âœ… æ­£ç¡® |
| `mapapi_req_total` | `mapapi_req_total` | âœ… æ­£ç¡® |
| `quest_req_total` | `quest_req_total` | âœ… æ­£ç¡® |

**éªŒè¯æ–¹æ³•ï¼š**
1. å¯åŠ¨åº”ç”¨
2. è®¿é—® http://localhost:8080/actuator/prometheus
3. æœç´¢æŒ‡æ ‡åç§°
4. å¦‚æœåç§°ä¸åŒ¹é…ï¼Œæ›´æ–°å‘Šè­¦è§„åˆ™

### 2. å‘Šè­¦é˜ˆå€¼éªŒè¯

æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´ä»¥ä¸‹é˜ˆå€¼ï¼š

| å‘Šè­¦è§„åˆ™ | å½“å‰é˜ˆå€¼ | å»ºè®®éªŒè¯ |
|---------|---------|---------|
| LLM é”™è¯¯ç‡ | 5% | æ ¹æ®ä¸šåŠ¡ SLA è°ƒæ•´ |
| LLM å»¶è¿Ÿ | 5 ç§’ï¼ˆP95ï¼‰ | æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ |
| ç¼“å­˜å‘½ä¸­ç‡ | 70% | æ ¹æ®ç¼“å­˜ç­–ç•¥è°ƒæ•´ |
| MQ å»¶è¿Ÿ | 10 ç§’ï¼ˆP95ï¼‰ | æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ |
| ä¸šåŠ¡é”™è¯¯ç‡ | 3% | æ ¹æ®ä¸šåŠ¡ SLA è°ƒæ•´ |
| æ¶ˆæ¯å»¶è¿Ÿ | 5 åˆ†é’Ÿ | æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ |

### 3. AlertManager é€šçŸ¥é…ç½®

**å½“å‰çŠ¶æ€ï¼š**
- âœ… AlertManager å·²é…ç½®
- âš ï¸ é€šçŸ¥æ¸ é“ä½¿ç”¨é»˜è®¤ webhookï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰

**ç”Ÿäº§ç¯å¢ƒéœ€è¦é…ç½®ï¼š**
- [ ] é‚®ä»¶é€šçŸ¥ï¼ˆSMTPï¼‰
- [ ] æˆ–é’‰é’‰ Webhook
- [ ] æˆ–ä¼ä¸šå¾®ä¿¡ Webhook
- [ ] æˆ–è‡ªå®šä¹‰ Webhook æœåŠ¡

**é…ç½®ä½ç½®ï¼š**
`docker/alertmanager/alertmanager.yml`

---

## ğŸ“‹ å¯åŠ¨åéªŒè¯æ­¥éª¤

### æ­¥éª¤1ï¼šå¯åŠ¨æ‰€æœ‰æœåŠ¡
```bash
cd docker
./start.sh
```

### æ­¥éª¤2ï¼šæ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
docker-compose ps
```

ç¡®è®¤ä»¥ä¸‹æœåŠ¡éƒ½æ­£å¸¸è¿è¡Œï¼š
- prometheus
- grafana
- alertmanager

### æ­¥éª¤3ï¼šéªŒè¯æŒ‡æ ‡
1. è®¿é—® http://localhost:8080/actuator/prometheus
2. æœç´¢å…³é”®æŒ‡æ ‡åç§°
3. ç¡®è®¤æŒ‡æ ‡æœ‰æ•°æ®

### æ­¥éª¤4ï¼šéªŒè¯å‘Šè­¦è§„åˆ™
1. è®¿é—® http://localhost:9090/alerts
2. æŸ¥çœ‹æ‰€æœ‰å‘Šè­¦è§„åˆ™çŠ¶æ€
3. ç¡®è®¤æ²¡æœ‰é”™è¯¯ï¼ˆçº¢è‰²çŠ¶æ€ï¼‰

### æ­¥éª¤5ï¼šéªŒè¯ AlertManager
1. è®¿é—® http://localhost:9093
2. æŸ¥çœ‹ AlertManager çŠ¶æ€
3. ç¡®è®¤ä¸ Prometheus è¿æ¥æ­£å¸¸

### æ­¥éª¤6ï¼šéªŒè¯ Grafana ä»ªè¡¨ç›˜
1. è®¿é—® http://localhost:3000
2. ç™»å½•ï¼ˆadmin/adminï¼‰
3. æŸ¥çœ‹æ‰€æœ‰ä»ªè¡¨ç›˜
4. ç¡®è®¤æ•°æ®æ­£å¸¸æ˜¾ç¤º

---

## ğŸ”§ å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šå‘Šè­¦è§„åˆ™æ˜¾ç¤ºé”™è¯¯

**åŸå› ï¼š**
- æŒ‡æ ‡åç§°ä¸åŒ¹é…
- PromQL è¡¨è¾¾å¼é”™è¯¯

**è§£å†³ï¼š**
1. åœ¨ Prometheus UI ä¸­æµ‹è¯•è¡¨è¾¾å¼
2. æ ¹æ®å®é™…æŒ‡æ ‡åç§°è°ƒæ•´å‘Šè­¦è§„åˆ™

### é—®é¢˜2ï¼šAlertManager æ— æ³•æ¥æ”¶å‘Šè­¦

**åŸå› ï¼š**
- Prometheus é…ç½®ä¸­ AlertManager åœ°å€é”™è¯¯
- AlertManager æœåŠ¡æœªå¯åŠ¨

**è§£å†³ï¼š**
1. æ£€æŸ¥ `prometheus.yml` ä¸­ `alerting.alertmanagers` é…ç½®
2. ç¡®è®¤ AlertManager æœåŠ¡æ­£å¸¸è¿è¡Œ

### é—®é¢˜3ï¼šGrafana ä»ªè¡¨ç›˜æ— æ•°æ®

**åŸå› ï¼š**
- æŒ‡æ ‡åç§°ä¸åŒ¹é…
- æ—¶é—´èŒƒå›´è®¾ç½®é”™è¯¯
- æ•°æ®æºé…ç½®é”™è¯¯

**è§£å†³ï¼š**
1. æ£€æŸ¥ Grafana æ•°æ®æºé…ç½®
2. åœ¨ Prometheus ä¸­éªŒè¯æŒ‡æ ‡æ˜¯å¦å­˜åœ¨
3. è°ƒæ•´ Grafana æ—¶é—´èŒƒå›´

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `docker/alertmanager/README.md` - AlertManager ä½¿ç”¨è¯´æ˜
- `docker/prometheus/README_ALERTS.md` - å‘Šè­¦è§„åˆ™è¯´æ˜
- `docker/grafana/dashboards/README.md` - ä»ªè¡¨ç›˜ä½¿ç”¨è¯´æ˜
- `docs/MONITORING_GAP_CHECK.md` - é—æ¼æ£€æŸ¥æŠ¥å‘Š
- `docs/MONITORING_FIXES.md` - ä¿®å¤æ¸…å•

