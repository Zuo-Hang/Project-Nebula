# ç›‘æ§å‘Šè­¦ä¿®å¤æ¸…å•

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. AlertManager ç¼ºå¤± âœ…

**ä¿®å¤å†…å®¹ï¼š**
- æ·»åŠ  AlertManager æœåŠ¡åˆ° `docker-compose.yml`
- åˆ›å»º `alertmanager.yml` é…ç½®æ–‡ä»¶
- é…ç½®å‘Šè­¦è·¯ç”±å’Œæ¥æ”¶è€…
- æ›´æ–° Prometheus é…ç½®ï¼Œè¿æ¥ AlertManager

**æ–‡ä»¶ï¼š**
- `docker/docker-compose.yml` - æ·»åŠ  AlertManager æœåŠ¡
- `docker/alertmanager/alertmanager.yml` - AlertManager é…ç½®
- `docker/prometheus/prometheus.yml` - æ·»åŠ  alerting é…ç½®
- `docker/alertmanager/README.md` - ä½¿ç”¨è¯´æ˜

### 2. Prometheus é…ç½®æŒ‚è½½é—®é¢˜ âœ…

**ä¿®å¤å†…å®¹ï¼š**
- ä¿®æ”¹ Prometheus æŒ‚è½½é…ç½®ï¼Œä»åªæŒ‚è½½å•ä¸ªæ–‡ä»¶æ”¹ä¸ºæŒ‚è½½æ•´ä¸ªç›®å½•
- ç¡®ä¿ `alert_rules.yml` å¯ä»¥è¢«æ­£ç¡®åŠ è½½

**ä¿®æ”¹å‰ï¼š**
```yaml
volumes:
  - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml:ro
```

**ä¿®æ”¹åï¼š**
```yaml
volumes:
  - ./prometheus:/etc/prometheus:ro
```

### 3. å‘Šè­¦è§„åˆ™ä¼˜åŒ– âœ…

**ä¿®å¤å†…å®¹ï¼š**
- ä¿®å¤å®šæ—¶ä»»åŠ¡å‘Šè­¦è§„åˆ™ï¼ˆ`scheduler_task` æ²¡æœ‰ status æ ‡ç­¾ï¼‰
- æ·»åŠ æ¶ˆæ¯å»¶è¿Ÿå‘Šè­¦
- æ·»åŠ è¿‡æœŸæ¶ˆæ¯å‘Šè­¦
- æ·»åŠ æ•°æ®å®Œæ•´æ€§å‘Šè­¦
- æ·»åŠ å¤–éƒ¨æœåŠ¡è°ƒç”¨å¤±è´¥å‘Šè­¦

**æ–°å¢å‘Šè­¦è§„åˆ™ï¼š**
1. `HighMessageLatency` - æ¶ˆæ¯å»¶è¿Ÿè¶…è¿‡ 5 åˆ†é’Ÿ
2. `TooManyExpiredMessages` - è¿‡æœŸæ¶ˆæ¯è¿‡å¤š
3. `DataIntegrityIssue` - æ•°æ®å®Œæ•´æ€§å¼‚å¸¸
4. `ExternalServiceFailure` - å¤–éƒ¨æœåŠ¡è°ƒç”¨å¤±è´¥

---

## âš ï¸ éœ€è¦æ³¨æ„çš„é—®é¢˜

### 1. æŒ‡æ ‡åç§°éªŒè¯

**é—®é¢˜ï¼š**
å‘Šè­¦è§„åˆ™ä¸­ä½¿ç”¨çš„æŒ‡æ ‡åç§°éœ€è¦åœ¨å®é™…è¿è¡ŒåéªŒè¯æ˜¯å¦æ­£ç¡®ã€‚

**éœ€è¦éªŒè¯çš„æŒ‡æ ‡ï¼š**
- `llm_req_duration_ms_bucket` - Timer æŒ‡æ ‡ä¼šè‡ªåŠ¨åˆ›å»º bucket
- `scheduler_task_duration_seconds` - `timing` æ–¹æ³•å¯èƒ½åˆ›å»ºçš„æ˜¯ `_seconds` åç¼€
- `msg_latency_s` - Gauge æŒ‡æ ‡ï¼Œéœ€è¦ç¡®è®¤å®é™…åç§°

**éªŒè¯æ–¹æ³•ï¼š**
1. å¯åŠ¨åº”ç”¨
2. è®¿é—® http://localhost:8080/actuator/prometheus
3. æŸ¥çœ‹å®é™…æš´éœ²çš„æŒ‡æ ‡åç§°
4. æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´å‘Šè­¦è§„åˆ™

### 2. AlertManager é€šçŸ¥é…ç½®

**å½“å‰çŠ¶æ€ï¼š**
- AlertManager å·²é…ç½®ï¼Œä½†é€šçŸ¥æ¸ é“ä½¿ç”¨é»˜è®¤çš„ webhookï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰

**ç”Ÿäº§ç¯å¢ƒéœ€è¦ï¼š**
- é…ç½®é‚®ä»¶é€šçŸ¥ï¼ˆSMTPï¼‰
- æˆ–é…ç½®é’‰é’‰/ä¼ä¸šå¾®ä¿¡ Webhook
- æˆ–é…ç½®è‡ªå®šä¹‰ Webhook æœåŠ¡

**é…ç½®ä½ç½®ï¼š**
ç¼–è¾‘ `docker/alertmanager/alertmanager.yml`ï¼Œå–æ¶ˆæ³¨é‡Šå¹¶é…ç½®ç›¸åº”çš„é€šçŸ¥æ¸ é“ã€‚

### 3. å‘Šè­¦é˜ˆå€¼è°ƒæ•´

**å½“å‰é˜ˆå€¼ï¼š**
- LLM é”™è¯¯ç‡ï¼š5%
- LLM å»¶è¿Ÿï¼š5 ç§’ï¼ˆP95ï¼‰
- ç¼“å­˜å‘½ä¸­ç‡ï¼š70%
- MQ å»¶è¿Ÿï¼š10 ç§’ï¼ˆP95ï¼‰
- ä¸šåŠ¡é”™è¯¯ç‡ï¼š3%

**å»ºè®®ï¼š**
æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚å’Œç”Ÿäº§ç¯å¢ƒæƒ…å†µè°ƒæ•´è¿™äº›é˜ˆå€¼ã€‚

---

## ğŸ“‹ å¾…éªŒè¯é¡¹

- [ ] å¯åŠ¨æœåŠ¡åéªŒè¯æ‰€æœ‰æŒ‡æ ‡åç§°æ˜¯å¦æ­£ç¡®
- [ ] éªŒè¯å‘Šè­¦è§„åˆ™æ˜¯å¦èƒ½æ­£å¸¸è§¦å‘
- [ ] éªŒè¯ AlertManager æ˜¯å¦èƒ½æ­£å¸¸æ¥æ”¶å‘Šè­¦
- [ ] é…ç½®ç”Ÿäº§ç¯å¢ƒçš„é€šçŸ¥æ¸ é“ï¼ˆé‚®ä»¶/é’‰é’‰/ä¼ä¸šå¾®ä¿¡ï¼‰
- [ ] æ ¹æ®å®é™…æ•°æ®è°ƒæ•´å‘Šè­¦é˜ˆå€¼
- [ ] æµ‹è¯•å‘Šè­¦æŠ‘åˆ¶è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆ

---

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

1. **å¯åŠ¨æœåŠ¡éªŒè¯**
   ```bash
   cd docker
   ./start.sh
   ```

2. **æ£€æŸ¥æŒ‡æ ‡**
   - è®¿é—® http://localhost:8080/actuator/prometheus
   - ç¡®è®¤æ‰€æœ‰æŒ‡æ ‡éƒ½æœ‰æ•°æ®

3. **æ£€æŸ¥å‘Šè­¦è§„åˆ™**
   - è®¿é—® http://localhost:9090/alerts
   - ç¡®è®¤å‘Šè­¦è§„åˆ™çŠ¶æ€æ­£å¸¸

4. **æ£€æŸ¥ AlertManager**
   - è®¿é—® http://localhost:9093
   - ç¡®è®¤ AlertManager æ­£å¸¸è¿è¡Œ

5. **é…ç½®é€šçŸ¥æ¸ é“**
   - æ ¹æ®å®é™…éœ€æ±‚é…ç½®é‚®ä»¶æˆ– Webhook

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `docker/alertmanager/README.md` - AlertManager ä½¿ç”¨è¯´æ˜
- `docker/prometheus/README_ALERTS.md` - å‘Šè­¦è§„åˆ™è¯´æ˜
- `docs/MONITORING_GAP_CHECK.md` - é—æ¼æ£€æŸ¥æŠ¥å‘Š

