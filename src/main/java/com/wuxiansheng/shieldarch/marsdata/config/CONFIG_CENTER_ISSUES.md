# é…ç½®ä¸­å¿ƒé—®é¢˜æ£€æŸ¥æŠ¥å‘Š

## âœ… å·²è§£å†³çš„é—®é¢˜

1. âœ… é…ç½®ç±»å‹æ”¯æŒ - `NacosConfigInitializer` å·²æ”¯æŒæŒ‡å®šé…ç½®ç±»å‹
2. âœ… æœ¬åœ°é…ç½®å›é€€ - æ”¯æŒä»æœ¬åœ°é…ç½®æ–‡ä»¶åŠ è½½é…ç½®
3. âœ… é…ç½®æ ¼å¼ä¿®å¤ - Properties æ–‡ä»¶æ ¼å¼å·²ä¿®å¤ï¼ˆå•è¡Œ JSONï¼‰

## âš ï¸ å‘ç°çš„é—®é¢˜

### 1. é…ç½®æ ¼å¼æ£€æµ‹ä¸å¤Ÿå‡†ç¡®

**é—®é¢˜æè¿°**ï¼š
- `NacosConfigService.parseConfigContent()` é€šè¿‡å†…å®¹çŒœæµ‹æ ¼å¼ï¼ˆæ£€æŸ¥æ˜¯å¦åŒ…å« `=` æˆ– `:`ï¼‰
- è¿™ç§æ–¹å¼ä¸å¤Ÿå‡†ç¡®ï¼Œå¯èƒ½è¯¯åˆ¤é…ç½®æ ¼å¼

**å½±å“**ï¼š
- å¦‚æœé…ç½®å†…å®¹åŒæ—¶åŒ…å« `=` å’Œ `:`ï¼Œå¯èƒ½è§£æé”™è¯¯
- æ— æ³•å‡†ç¡®è¯†åˆ« JSON æ ¼å¼

**å»ºè®®ä¿®å¤**ï¼š
- ä» Nacos è·å–é…ç½®æ—¶ï¼Œåº”è¯¥çŸ¥é“é…ç½®ç±»å‹ï¼ˆå¦‚æœ Nacos API æ”¯æŒï¼‰
- æˆ–è€…æ”¹è¿›æ ¼å¼æ£€æµ‹é€»è¾‘ï¼Œæ”¯æŒ JSON æ ¼å¼è¯†åˆ«
- æˆ–è€…ç¼“å­˜é…ç½®ç±»å‹ä¿¡æ¯

### 2. æœ¬åœ°é…ç½®æ–‡ä»¶åªæ”¯æŒ Properties æ ¼å¼

**é—®é¢˜æè¿°**ï¼š
- `loadFromLocalFile()` æ–¹æ³•ç¡¬ç¼–ç äº† `.properties` æ‰©å±•å
- ä¸æ”¯æŒ YAML æˆ– JSON æ ¼å¼çš„æœ¬åœ°é…ç½®æ–‡ä»¶

**å½±å“**ï¼š
- å¦‚æœæœ¬åœ°é…ç½®æ–‡ä»¶æ˜¯ YAML æ ¼å¼ï¼Œæ— æ³•åŠ è½½
- ä¸ Nacos ä¸­çš„é…ç½®æ ¼å¼ä¸ä¸€è‡´æ—¶ï¼Œå¯èƒ½æ— æ³•å›é€€

**å»ºè®®ä¿®å¤**ï¼š
- æ”¯æŒå¤šç§æ ¼å¼çš„æœ¬åœ°é…ç½®æ–‡ä»¶ï¼ˆproperties, yaml, jsonï¼‰
- æŒ‰ä¼˜å…ˆçº§å°è¯•åŠ è½½ä¸åŒæ ¼å¼çš„é…ç½®æ–‡ä»¶

### 3. é…ç½®ç±»å‹æ²¡æœ‰ç¼“å­˜

**é—®é¢˜æè¿°**ï¼š
- æ¯æ¬¡è§£æé…ç½®æ—¶éƒ½è¦çŒœæµ‹æ ¼å¼
- æ²¡æœ‰ç¼“å­˜é…ç½®ç±»å‹ä¿¡æ¯

**å½±å“**ï¼š
- æ€§èƒ½é—®é¢˜ï¼ˆè™½ç„¶å½±å“å¾ˆå°ï¼‰
- æ ¼å¼æ£€æµ‹å¯èƒ½ä¸ä¸€è‡´

**å»ºè®®ä¿®å¤**ï¼š
- ç¼“å­˜é…ç½®ç±»å‹ä¿¡æ¯ï¼ˆData ID -> Config Typeï¼‰
- é¦–æ¬¡è·å–é…ç½®æ—¶ç¡®å®šç±»å‹ï¼Œåç»­ç›´æ¥ä½¿ç”¨

### 4. é…ç½®ç›‘å¬å™¨æ›´æ–°åæ²¡æœ‰é€šçŸ¥æœºåˆ¶

**é—®é¢˜æè¿°**ï¼š
- é…ç½®æ›´æ–°åï¼Œåªæ›´æ–°äº†ç¼“å­˜
- æ²¡æœ‰é€šçŸ¥å…¶ä»–ç»„ä»¶é…ç½®å·²æ›´æ–°

**å½±å“**ï¼š
- å…¶ä»–ç»„ä»¶å¯èƒ½ä½¿ç”¨æ—§çš„é…ç½®
- éœ€è¦é‡å¯åº”ç”¨æ‰èƒ½ç”Ÿæ•ˆ

**å»ºè®®ä¿®å¤**ï¼š
- å®ç°é…ç½®æ›´æ–°äº‹ä»¶æœºåˆ¶
- ä½¿ç”¨ Spring çš„ `ApplicationEventPublisher` å‘å¸ƒé…ç½®æ›´æ–°äº‹ä»¶
- å…¶ä»–ç»„ä»¶å¯ä»¥ç›‘å¬é…ç½®æ›´æ–°äº‹ä»¶å¹¶é‡æ–°åŠ è½½é…ç½®

### 5. Properties è§£æä¸æ”¯æŒè½¬ä¹‰å­—ç¬¦

**é—®é¢˜æè¿°**ï¼š
- `parseProperties()` æ–¹æ³•ä½¿ç”¨ç®€å•çš„å­—ç¬¦ä¸²åˆ†å‰²
- ä¸æ”¯æŒ Properties æ ¼å¼çš„è½¬ä¹‰å­—ç¬¦ï¼ˆå¦‚ `\n`, `\t`, `\\` ç­‰ï¼‰

**å½±å“**ï¼š
- å¦‚æœé…ç½®å€¼åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œå¯èƒ½è§£æé”™è¯¯
- åº”è¯¥ä½¿ç”¨ Java çš„ `Properties.load()` æ–¹æ³•

**å»ºè®®ä¿®å¤**ï¼š
- ä½¿ç”¨æ ‡å‡†çš„ `Properties.load()` æ–¹æ³•è§£æ
- æˆ–è€…ä½¿ç”¨ Apache Commons Configuration åº“

### 6. YAML è§£æè¿‡äºç®€åŒ–

**é—®é¢˜æè¿°**ï¼š
- `parseYaml()` æ–¹æ³•åªæ”¯æŒç®€å•çš„ `key: value` æ ¼å¼
- ä¸æ”¯æŒåµŒå¥—ç»“æ„ã€æ•°ç»„ç­‰å¤æ‚æ ¼å¼

**å½±å“**ï¼š
- å¦‚æœé…ç½®æ˜¯å¤æ‚çš„ YAML ç»“æ„ï¼Œæ— æ³•æ­£ç¡®è§£æ
- åº”è¯¥ä½¿ç”¨ä¸“ä¸šçš„ YAML è§£æåº“ï¼ˆå¦‚ SnakeYAMLï¼‰

**å»ºè®®ä¿®å¤**ï¼š
- ä½¿ç”¨ SnakeYAML åº“è§£æ YAML
- æˆ–è€…é™åˆ¶é…ç½®æ ¼å¼ä¸ºç®€å•çš„ key-value å¯¹

## ğŸ“‹ ä¼˜å…ˆçº§å»ºè®®

### é«˜ä¼˜å…ˆçº§ï¼ˆå½±å“åŠŸèƒ½ï¼‰
1. **Properties è§£ææ”¯æŒè½¬ä¹‰å­—ç¬¦** - ä½¿ç”¨æ ‡å‡†åº“è§£æ
2. **æœ¬åœ°é…ç½®æ–‡ä»¶æ”¯æŒå¤šç§æ ¼å¼** - æ”¯æŒ yaml/json

### ä¸­ä¼˜å…ˆçº§ï¼ˆå½±å“ä½“éªŒï¼‰
3. **é…ç½®æ ¼å¼æ£€æµ‹æ”¹è¿›** - æ”¯æŒ JSON æ ¼å¼è¯†åˆ«
4. **é…ç½®ç±»å‹ç¼“å­˜** - æå‡æ€§èƒ½

### ä½ä¼˜å…ˆçº§ï¼ˆä¼˜åŒ–å»ºè®®ï¼‰
5. **é…ç½®æ›´æ–°é€šçŸ¥æœºåˆ¶** - æ”¯æŒçƒ­æ›´æ–°
6. **YAML è§£ææ”¹è¿›** - æ”¯æŒå¤æ‚ç»“æ„ï¼ˆå¦‚æœç¡®å®éœ€è¦ï¼‰

## ğŸ”§ å¿«é€Ÿä¿®å¤å»ºè®®

### ä¿®å¤ 1: Properties è§£æä½¿ç”¨æ ‡å‡†åº“

```java
private Map<String, String> parseProperties(String content) {
    Map<String, String> result = new HashMap<>();
    try {
        Properties properties = new Properties();
        properties.load(new StringReader(content));
        properties.forEach((key, value) -> 
            result.put(key.toString(), value.toString())
        );
    } catch (IOException e) {
        log.error("è§£æ Properties æ ¼å¼å¤±è´¥: {}", e.getMessage(), e);
    }
    return result;
}
```

### ä¿®å¤ 2: æœ¬åœ°é…ç½®æ–‡ä»¶æ”¯æŒå¤šç§æ ¼å¼

```java
private Map<String, String> loadFromLocalFile(String namespace) {
    // æŒ‰ä¼˜å…ˆçº§å°è¯•åŠ è½½ä¸åŒæ ¼å¼
    String[] extensions = {"properties", "yaml", "yml", "json"};
    for (String ext : extensions) {
        String configPath = "config/" + namespace + "." + ext;
        Resource resource = new ClassPathResource(configPath);
        if (resource.exists()) {
            // æ ¹æ®æ‰©å±•åé€‰æ‹©è§£ææ–¹æ³•
            return loadConfigFromResource(resource, ext);
        }
    }
    return new HashMap<>();
}
```

### ä¿®å¤ 3: é…ç½®æ ¼å¼æ£€æµ‹æ”¹è¿›

```java
private Map<String, String> parseConfigContent(String content) {
    // 1. å°è¯•è§£æä¸º JSON
    if (isJsonFormat(content)) {
        return parseJson(content);
    }
    // 2. å°è¯•è§£æä¸º Properties
    if (isPropertiesFormat(content)) {
        return parseProperties(content);
    }
    // 3. å°è¯•è§£æä¸º YAML
    return parseYaml(content);
}

private boolean isJsonFormat(String content) {
    String trimmed = content.trim();
    return trimmed.startsWith("{") && trimmed.endsWith("}");
}
```

