spring:
  application:
    name: Project-Nebula
  profiles:
    active: ${APP_ENV:prod}

# 应用配置
app:
  http-port: ":8080"
  pprof-port: ":6060"
  env: ${APP_ENV:prod}

# Redis配置
redis:
  enabled: true
  service-name: ${REDIS_SERVICE_NAME:}  # 服务名称（支持服务发现格式，如 "disf!service-name" 或直接 IP:Port）
  max-idle: 10
  max-active: 100
  idle-timeout: 300
  auth: ${REDIS_AUTH:}
  conn-timeout: 3000
  read-timeout: 3000
  write-timeout: 3000
  max-conn-lifetime: 3600

# MySQL配置
mysql:
  enabled: true
  switch: ${MYSQL_SWITCH:true}
  addr: ${MYSQL_ADDR:}
  service-name: ${MYSQL_SERVICE_NAME:}  # 服务名称（支持服务发现格式，如 "disf!service-name" 或直接 IP:Port）
  max-open-conn: 100
  max-idle-conn: 10
  max-life-time: 3600

# 数据源配置（使用Druid）
spring:
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: ${MYSQL_URL:jdbc:mysql://localhost:3306/mars_data?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai}
    username: ${MYSQL_USERNAME:root}
    password: ${MYSQL_PASSWORD:}
    druid:
      initial-size: 5
      min-idle: 5
      max-active: 100
      max-wait: 60000
      time-between-eviction-runs-millis: 60000
      min-evictable-idle-time-millis: 300000
      validation-query: SELECT 1
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false

# MyBatis Plus配置
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl
  global-config:
    db-config:
      id-type: auto
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0

# Redisson配置
spring:
  data:
    redisson:
      config: |
        singleServerConfig:
          address: ${REDIS_ADDRESS:redis://localhost:6379}
          password: ${REDIS_PASSWORD:redis123456}
          connectionPoolSize: 100
          connectionMinimumIdleSize: 10
          idleConnectionTimeout: 300000
          connectTimeout: 3000
          timeout: 3000

# 日志配置
logging:
  level:
    root: INFO
    com.wuxiansheng.shieldarch.marsdata: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: ./log/project-nebula.log
    max-size: 100MB
    max-history: 30

# RocketMQ配置
rocketmq:
  name-server: ${ROCKETMQ_NAME_SERVER:localhost:9876}
  producer:
    group: ${ROCKETMQ_PRODUCER_GROUP:project-nebula-producer-group}
    send-message-timeout: 3000
    retry-times-when-send-failed: 3
    retry-times-when-send-async-failed: 3
    max-message-size: 4194304
    compress-message-body-threshold: 4096

# MQ配置（业务配置）
mq:
  producer:
    quest-backstrace-topic: ${MQ_QUEST_BACKSTRACE_TOPIC:ocr_backstrace}
    ocr-video-capture-topic: ${MQ_OCR_VIDEO_CAPTURE_TOPIC:ocr_video_capture}
  consumers:
    ocr_video_capture:
      group: ${MQ_CONSUMER_GROUP:cg_ocr_video_capture_consumer_pre}
      thread-num: ${MQ_CONSUMER_THREAD_NUM:30}
      consume-message-batch-max-size: ${MQ_CONSUME_BATCH_SIZE:1}

# Actuator配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}
      environment: ${app.env:prod}

# 监控配置
monitoring:
  # 监控类型：prometheus（已完全迁移到 Prometheus）
  type: ${MONITORING_TYPE:prometheus}

# 定时任务配置
scheduler:
  video-list:
    enabled: ${SCHEDULER_VIDEO_LIST_ENABLED:true}
    bucket: ${SCHEDULER_VIDEO_LIST_BUCKET:}
    prefix: ${SCHEDULER_VIDEO_LIST_PREFIX:}
    mq-topic: ${SCHEDULER_VIDEO_LIST_MQ_TOPIC:ocr_video_capture}
    redis-ttl-days: ${SCHEDULER_VIDEO_LIST_REDIS_TTL_DAYS:30}

# LLM 配置
llm:
  use-langchain4j: ${LLM_USE_LANGCHAIN4J:true}

# Nacos 配置（服务发现 + 配置中心）
nacos:
  enabled: ${NACOS_ENABLED:true}
  server-addr: ${NACOS_SERVER_ADDR:127.0.0.1:8848}
  namespace: ${NACOS_NAMESPACE:}
  username: ${NACOS_USERNAME:nacos}
  password: ${NACOS_PASSWORD:nacos}
  config:
    enabled: ${NACOS_CONFIG_ENABLED:true}
    group: ${NACOS_CONFIG_GROUP:DEFAULT_GROUP}
    app-id: ${NACOS_CONFIG_APP_ID:project-nebula}
    # 是否启用本地配置回退（当 Nacos 不可用时，从 classpath:config/ 目录加载配置）
    fallback-to-local: ${NACOS_CONFIG_FALLBACK_TO_LOCAL:true}
  # 服务注册配置
  service-registry:
    enabled: ${NACOS_SERVICE_REGISTRY_ENABLED:true}
    service-name: ${NACOS_SERVICE_REGISTRY_SERVICE_NAME:${spring.application.name}}
    group-name: ${NACOS_SERVICE_REGISTRY_GROUP_NAME:DEFAULT_GROUP}
    ip: ${NACOS_SERVICE_REGISTRY_IP:}  # 留空则自动获取本机 IP
    weight: ${NACOS_SERVICE_REGISTRY_WEIGHT:1.0}  # 服务权重
    healthy: ${NACOS_SERVICE_REGISTRY_HEALTHY:true}  # 是否健康
    ephemeral: ${NACOS_SERVICE_REGISTRY_EPHEMERAL:true}  # 是否临时实例（临时实例会在服务下线时自动删除）
    metadata: ${NACOS_SERVICE_REGISTRY_METADATA:}  # 元数据（格式：key1=value1,key2=value2）
